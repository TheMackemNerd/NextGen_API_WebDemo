<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta http-equiv='cache-control' content='no-cache'>
    <meta http-equiv='expires' content='0'>
    <meta http-equiv='pragma' content='no-cache'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/style.css">

    <link rel="stylesheet" href="https://styleguide.ngiris.com/assets/css/guide.css?v=325">
    <link rel="stylesheet" href="https://styleguide.ngiris.com/assets/css/iris-ui.css?v-234">

    <!-- jQuery -->
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.browser.min.js"></script>

    <!-- POC Scripts -->
    <script src="js/securecheck.js"></script>
    <script src="js/banner.js"></script>

    <script language="JavaScript" type="text/javascript"
            src="http://kjur.github.io/jsrsasign/jsrsasign-latest-all-min.js">
    </script>

    <title>API and Authentication POC Client</title>
</head>
<body>

    <a href="#main" class="sg-skip-to-content">Tap Enter to skip to main content</a>

    <header class="sg-header">
        <nav>
            <ul>
                <li class="sg-header-company">
                    <a href="/" aria-label="Go to the homepage" title="Homepage">
                        <img src="images/iris-logo-white.png" alt="IRIS">
                    </a>
                </li>
                <li class="sg-header-sections open-toggle">
                    <button type="button" class="sg-header-menu-button" aria-label="Open main menu"></button>
                    <ul>
                        <li><a href="logout.html">Logout</a></li>
                    </ul>
                </li>

            </ul>
        </nav>
        <span class="sg-header-stripe"></span>
    </header>

    <main class="sg-main" id="main">

        <div class="content">

            <div class="sg-panel-group" id="pnlIsLoggedOut" hidden="hidden">
                <div class="sg-panel">
                    <div class="sg-panel-contents-light">
                        <h1>Not Authorised!</h1>
                        <br />
                        <a class="sg-btn-primary" href="secure.html">Login</a>
                    </div>
                </div>
            </div>

            <div class="sg-panel-group" id="pnlIsLoggedIn">
                <div class="sg-panel">
                    <div class="sg-panel-contents-light">
                        <h1>Secure Resource</h1>
                        <table width="100%">
                            <tr>
                                <td width="25%"><label class="sg-label" for="txtKeyPath">Key Path</label></td>
                                <td width="75%"><input type="text" class="sg-input sg-input-large" size="90" id="txtKeyPath" value="https://cognito-idp.eu-west-1.amazonaws.com/eu-west-1_2DtCcoypN/.well-known/jwks.json" /></td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td>
                                    <button class="sg-btn-primary" id="btnKeys" onclick="getKeys();">Get Keys</button>
                                    <br />
                                    <div id="divKeyAlert" hidden="hidden">
                                        <span class="sg-notice" role="alert" id="spaKeyWarn"></span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                            </tr>
                            <tr>
                                <td><label class="sg-label" for="txtKeys">Keys</label></td>
                                <td><textarea id="txtKeys" class="sg-textarea" rows="9"></textarea></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
</main>

    <script>

        
        if (isInSession()) {

            document.getElementById("pnlIsLoggedOut").hidden = "hidden";
            document.getElementById("pnlIsLoggedIn").hidden = "";
        }
        else {
            document.getElementById("pnlIsLoggedOut").hidden = "";
            document.getElementById("pnlIsLoggedIn").hidden = "hidden";
        }
        

        function getKeys() {

            callForKeys(function (result) {
                document.getElementById("txtKeys").value = JSON.stringify(result);
            });

        }

        async function callForKeys(callback) {
            var request = new XMLHttpRequest();            
            request.open('GET', document.getElementById("txtKeyPath").value);            
            request.onload = function () {
                alert("here");
                var data = this.response;                
                callback(data);
            }
            request.send();
        }

    </script>

</body>
</html>

